<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    {% include "_mobile_styles.html" %}

    <title>Dashboard - StudyCore</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        nav {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav h2 { color: #667eea; }
        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .nav-links a {
            color: #667eea;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: background 0.2s;
        }
        .nav-links a:hover, .nav-links a.active {
            background: #f0f0f0;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        .logout {
            color: #667eea;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 2px solid #667eea;
            border-radius: 6px;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .greeting {
            margin-bottom: 2rem;
        }
        .greeting h1 {
            font-size: 2rem;
            color: #1a1a1a;
            margin-bottom: 0.5rem;
        }
        .greeting p {
            color: #666;
            font-size: 1.1rem;
        }

        /* Due Today Section */
        .due-today {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
        }
        .due-today h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .review-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .review-card:last-child {
            margin-bottom: 0;
        }
        .review-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }
        .review-meta {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        .btn-review {
            background: white;
            color: #667eea;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .btn-review:hover {
            transform: scale(1.05);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
        }
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .action-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .action-card:hover {
            transform: translateY(-3px);
        }
        .action-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .action-card h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        .action-card p {
            color: #666;
            font-size: 0.95rem;
        }

        /* Stats Overview */
        .stats-overview {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        .stats-overview h2 {
            color: #1a1a1a;
            margin-bottom: 1.5rem;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 0.25rem;
        }
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            .greeting h1 {
                font-size: 1.5rem;
            }
            .review-card {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
    {% include "base_analytics.html" %}
</head>
<body>
    <nav>
        <h2>üìö StudyCore</h2>
        <div class="nav-links">
            <a href="/dashboard" class="active">Home</a>
            <a href="/topics">Topics</a>
            <a href="/analytics">Progress</a>
            <a href="/feedback">Feedback</a>
        </div>
        <div class="user-info">
            {% if user.picture %}
            <img src="{{ user.picture }}" alt="{{ user.name }}">
            {% endif %}
            <span>{{ user.name }}</span>
            <a href="/auth/logout" class="logout">Logout</a>
        </div>
    </nav>

    <div class="container">
        <div class="greeting">
            <h1>üëã Welcome back, {{ user.name.split()[0] }}!</h1>
            <p id="greetingText">Let's see what you need to review today...</p>
        </div>

        <!-- Due Today Section (now first) -->
        <div class="due-today">
            <h2>üîî Review Today</h2>
            <div id="dueReviews">
                <div class="empty-state">
                    <div class="empty-state-icon">‚è≥</div>
                    <p>Loading your reviews...</p>
                </div>
            </div>
        </div>

        <!-- Memory Risk Dashboard (now second) -->
        <div id="memoryRiskDashboard" style="margin-bottom: 2rem;">
            <div style="background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                <h2 style="color: #667eea; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                    üß† Memory Strength Overview
                </h2>
                
                <!-- Loading State -->
                <div id="memoryStatsLoading">
                    <p style="color: #999;">Loading memory stats...</p>
                </div>
                
                <!-- Stats Display (Hidden initially) -->
                <div id="memoryStatsContent" style="display: none;">
                    <!-- Exam Ready Metric -->
                    <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                border-radius: 12px; margin-bottom: 2rem; color: white;">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">EXAM-READY TOPICS</div>
                        <div style="font-size: 4rem; font-weight: 900;" id="examReadyPercent">0%</div>
                        <div style="font-size: 1rem; opacity: 0.95; margin-top: 0.5rem;" id="examReadyMessage">
                            Keep training to increase this number
                        </div>
                    </div>
                    
                    <!-- Risk Alert (Only show if topics at risk > 0) -->
                    <div id="riskAlert" style="display: none; background: #fef2f2; border-left: 4px solid #ef4444; 
                                               padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 2rem;">‚ö†Ô∏è</div>
                            <div style="flex: 1;">
                                <strong style="color: #dc2626; font-size: 1.1rem;" id="riskAlertText">
                                    3 topics at risk of being forgotten
                                </strong>
                                <p style="color: #666; margin-top: 0.5rem; font-size: 0.9rem;">
                                    Review these soon to prevent memory decay
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status Breakdown -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div id="statusCritical" style="background: #fef2f2; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üî¥</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #ef4444;">0</div>
                            <div style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">CRITICAL</div>
                        </div>
                        
                        <div id="statusWeak" style="background: #fff7ed; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üü†</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #f97316;">0</div>
                            <div style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">WEAK</div>
                        </div>
                        
                        <div id="statusStrengthening" style="background: #fefce8; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üü°</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #eab308;">0</div>
                            <div style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">STRENGTHENING</div>
                        </div>
                        
                        <div id="statusStrong" style="background: #f0fdf4; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üü¢</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">0</div>
                            <div style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">STRONG</div>
                        </div>
                        
                        <div id="statusAutomatic" style="background: #faf5ff; padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üíé</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #8b5cf6;">0</div>
                            <div style="font-size: 0.8rem; color: #999; margin-top: 0.25rem;">AUTOMATIC</div>
                        </div>
                    </div>
                    
                    <!-- Topics Needing Attention -->
                    <div id="attentionTopicsSection" style="display: none;">
                        <h3 style="color: #1a1a1a; margin-bottom: 1rem; font-size: 1.1rem;">
                            üéØ Needs Your Attention
                        </h3>
                        <div id="attentionTopicsList" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="action-card" onclick="window.location.href='/topics'">
                <div class="action-icon">üìñ</div>
                <h3>My Topics</h3>
                <p>View all topics you're learning</p>
            </div>

            <div class="action-card" onclick="window.location.href='/topics'">
                <div class="action-icon">‚ûï</div>
                <h3>Add Topic</h3>
                <p>Start learning something new</p>
            </div>

            <div class="action-card" onclick="window.location.href='/analytics'">
                <div class="action-icon">üìä</div>
                <h3>Progress</h3>
                <p>See your learning stats</p>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="stats-overview">
            <h2>üìà Your Progress</h2>
            <div class="stats-grid" id="quickStats">
                <div class="stat-item">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Topics</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Explains</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Avg Confidence</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>

        <!-- Study Flow Guide (NOW AT BOTTOM) -->
        <div id="studyGuide" style="background: white; padding: 2rem; border-radius: 16px; margin-bottom: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
            <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleGuide()">
                <h3 style="color: #667eea; font-size: 1.3rem;">üìñ How to Use StudyCore (Click to expand)</h3>
                <span id="guideToggle" style="font-size: 1.5rem;">‚ñº</span>
            </div>

            <div id="guideContent" style="display: none; margin-top: 1.5rem;">
                <p style="color: #666; line-height: 1.7; margin-bottom: 1.5rem;">
                    <strong>StudyCore works BEST when used as part of your study routine.</strong> Here's the proven 5-step flow:
                </p>

                <div style="display: grid; gap: 1.5rem;">
                    <!-- Step 1 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 12px;">
                        <div style="min-width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                        <div>
                            <h4 style="color: #1a1a1a; margin-bottom: 0.5rem;">üìñ Read & Highlight (10-15 mins)</h4>
                            <p style="color: #666; font-size: 0.95rem;">Read your notes/textbook. Identify the 3-5 big ideas. Don't copy everything‚Äîjust spot the key concepts.</p>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 12px;">
                        <div style="min-width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                        <div>
                            <h4 style="color: #1a1a1a; margin-bottom: 0.5rem;">‚ûï Create Topic (10 seconds)</h4>
                            <p style="color: #666; font-size: 0.95rem;">Click "Add Topic" ‚Üí Enter subject & title ‚Üí Save. That's it.</p>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 12px;">
                        <div style="min-width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                        <div>
                            <h4 style="color: #1a1a1a; margin-bottom: 0.5rem;">üéØ Explain Mode (5 mins)</h4>
                            <p style="color: #666; font-size: 0.95rem;"><strong>CLOSE YOUR NOTES.</strong> Click "Explain" ‚Üí Start timer ‚Üí Teach the topic OUT LOUD to yourself. Struggle = learning. This is the magic.</p>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 12px;">
                        <div style="min-width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                        <div>
                            <h4 style="color: #1a1a1a; margin-bottom: 0.5rem;">üí≠ Reflect & Rate (2 mins)</h4>
                            <p style="color: #666; font-size: 0.95rem;">Write what you struggled with. Rate confidence 1-5. The app automatically schedules your next review.</p>
                        </div>
                    </div>

                    <!-- Step 5 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 12px;">
                        <div style="min-width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">5</div>
                        <div>
                            <h4 style="color: #1a1a1a; margin-bottom: 0.5rem;">üîÑ Review When Due</h4>
                            <p style="color: #666; font-size: 0.95rem;">Open StudyCore daily. Check "Review Today" above. Explain again. Confidence improves. Repeat until mastered.</p>
                        </div>
                    </div>
                </div>

                <div style="background: #f0f4ff; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem; border-left: 4px solid #667eea;">
                    <p style="color: #1a1a1a; margin: 0; line-height: 1.6;">
                        <strong>üí° Pro Tip:</strong> Use StudyCore AFTER you've read the material, not before.
                        Reading ‚Üí StudyCore ‚Üí Review. This is the proven formula.
                    </p>
                </div>

                <div style="text-align: center; margin-top: 1.5rem;">
                    <button onclick="dismissGuide()" style="background: #667eea; color: white; padding: 0.75rem 2rem; border: none; border-radius: 50px; font-weight: 600; cursor: pointer;">
                        Got it! Let's Start
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get current time for greeting
        const hour = new Date().getHours();
        let greeting = "Good evening";
        if (hour < 12) greeting = "Good morning";
        else if (hour < 18) greeting = "Good afternoon";

        document.getElementById('greetingText').textContent =
            greeting + "! Here's what needs your attention today.";

        // Study Guide Toggle Functions
        function toggleGuide() {
            const content = document.getElementById('guideContent');
            const toggle = document.getElementById('guideToggle');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                toggle.textContent = '‚ñº';
            }
        }

        function dismissGuide() {
            document.getElementById('studyGuide').style.display = 'none';
            localStorage.setItem('guide_dismissed', 'true');
        }

        // Auto-expand guide for new users
        window.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('guide_dismissed')) {
                document.getElementById('guideContent').style.display = 'block';
                document.getElementById('guideToggle').textContent = '‚ñ≤';
            }
        });

        // Load memory stats on page load
        async function loadMemoryStats() {
            try {
                const response = await fetch('/api/topics/memory-stats');
                const data = await response.json();
                
                // Hide loading, show content
                document.getElementById('memoryStatsLoading').style.display = 'none';
                document.getElementById('memoryStatsContent').style.display = 'block';
                
                // Update exam-ready percentage
                const examReadyPercent = data.exam_ready_percent;
                document.getElementById('examReadyPercent').textContent = examReadyPercent + '%';
                
                // Update message based on percentage
                const messageEl = document.getElementById('examReadyMessage');
                if (examReadyPercent >= 80) {
                    messageEl.textContent = 'üéâ Excellent! You\'re well-prepared';
                    messageEl.style.color = '#10b981';
                } else if (examReadyPercent >= 50) {
                    messageEl.textContent = 'Good progress! Keep strengthening';
                } else if (examReadyPercent > 0) {
                    messageEl.textContent = 'Keep training to increase this number';
                } else {
                    messageEl.textContent = 'Start explaining topics to build memory strength';
                }
                
                // Show risk alert if needed
                if (data.topics_at_risk > 0) {
                    document.getElementById('riskAlert').style.display = 'block';
                    document.getElementById('riskAlertText').textContent = 
                        `${data.topics_at_risk} topic${data.topics_at_risk !== 1 ? 's' : ''} at risk of being forgotten`;
                }
                
                // Update status counts
                document.querySelector('#statusCritical div:nth-child(2)').textContent = data.by_status.CRITICAL;
                document.querySelector('#statusWeak div:nth-child(2)').textContent = data.by_status.WEAK;
                document.querySelector('#statusStrengthening div:nth-child(2)').textContent = data.by_status.STRENGTHENING;
                document.querySelector('#statusStrong div:nth-child(2)').textContent = data.by_status.STRONG;
                document.querySelector('#statusAutomatic div:nth-child(2)').textContent = data.by_status.AUTOMATIC;
                
                // Show topics needing attention
                if (data.topics_needing_attention.length > 0) {
                    document.getElementById('attentionTopicsSection').style.display = 'block';
                    
                    const listHTML = data.topics_needing_attention.map(topic => {
                        const strength = topic.strength;
                        return `
                            <div style="background: white; padding: 1rem; border-radius: 8px; 
                                        border-left: 4px solid ${strength.color}; 
                                        display: flex; justify-content: space-between; align-items: center;
                                        box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #1a1a1a; margin-bottom: 0.25rem;">
                                        ${topic.title}
                                    </div>
                                    <div style="font-size: 0.85rem; color: ${strength.color};">
                                        ${strength.emoji} ${strength.message}
                                    </div>
                                </div>
                                <button onclick="window.location.href='/explain/${topic.id}'" 
                                        style="background: ${strength.color}; color: white; 
                                               border: none; padding: 0.5rem 1rem; border-radius: 6px; 
                                               font-weight: 600; cursor: pointer; white-space: nowrap;">
                                    Explain Now
                                </button>
                            </div>
                        `;
                    }).join('');
                    
                    document.getElementById('attentionTopicsList').innerHTML = listHTML;
                }
                
            } catch (error) {
                console.error('Error loading memory stats:', error);
                document.getElementById('memoryStatsLoading').innerHTML = 
                    '<p style="color: #ef4444;">Error loading stats. Please refresh.</p>';
            }
        }

        // Load due reviews
        async function loadDueReviews() {
            try {
                const timestamp = new Date().getTime();
                const response = await fetch(`/api/due-today?t=${timestamp}`);
                const data = await response.json();

                const container = document.getElementById('dueReviews');

                if (data.total_due === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚ú®</div>
                            <h3 style="margin-bottom: 0.5rem;">Nothing due today!</h3>
                            <p style="opacity: 0.9; margin-bottom: 1.5rem;">
                                You're all caught up. Want to learn something new?
                            </p>
                            <button onclick="window.location.href='/topics'" class="btn-review">
                                Browse Topics
                            </button>
                        </div>
                    `;
                    return;
                }

                let html = '';

                // Show scheduled reviews with correct field names
                data.due_schedules.forEach(review => {
                    // Determine status message
                    let statusMessage = '';
                    if (review.status === 'overdue') {
                        const days = review.days_overdue;
                        statusMessage = `${days} day${days !== 1 ? 's' : ''} overdue`;
                    } else {
                        statusMessage = 'Due today';
                    }

                    html += `
                        <div class="review-card">
                            <div class="review-info">
                                <h3>${review.topic || 'Untitled Topic'}</h3>
                                <div class="review-meta">
                                    Scheduled review ¬∑ ${statusMessage}
                                </div>
                            </div>
                            ${review.can_explain ?
                                `<a href="/explain/${review.topic_id}" class="btn-review">
                                    üéØ Review Now
                                </a>` :
                                `<button onclick="createTopic('${review.topic}')" class="btn-review">
                                    + Create Topic First
                                </button>`
                            }
                        </div>
                    `;
                });

                // Show topics needing review
                data.topics_needing_review.forEach(topic => {
                    html += `
                        <div class="review-card">
                            <div class="review-info">
                                <h3>${topic.title}</h3>
                                <div class="review-meta">
                                    Last reviewed ${topic.days_since} day${topic.days_since !== 1 ? 's' : ''} ago ¬∑
                                    Confidence: ${topic.confidence}/5
                                </div>
                            </div>
                            <a href="/explain/${topic.topic_id}" class="btn-review">
                                üîÑ Review Again
                            </a>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading reviews:', error);
                document.getElementById('dueReviews').innerHTML = `
                    <div class="empty-state">
                        <p style="color: rgba(255,255,255,0.8);">
                            Error loading reviews. Please refresh the page.
                        </p>
                    </div>
                `;
            }
        }

        // Load quick stats
        async function loadQuickStats() {
            try {
                const response = await fetch('/api/analytics/stats');
                const data = await response.json();

                document.getElementById('quickStats').innerHTML = `
                    <div class="stat-item">
                        <div class="stat-value">${data.total_topics || 0}</div>
                        <div class="stat-label">Topics</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${data.total_explains || 0}</div>
                        <div class="stat-label">Explains</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${data.avg_confidence || 0}/5</div>
                        <div class="stat-label">Avg Confidence</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${data.current_streak || 0}</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        function createTopic(topicName) {
            localStorage.setItem('prefill_topic', topicName);
            window.location.href = '/topics';
        }

        // Load everything
        window.addEventListener('DOMContentLoaded', () => {
            loadMemoryStats();
            loadDueReviews();
            loadQuickStats();
        });
    </script>
</body>
</html>
